<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Zag Metrics</title>
    <link rel="stylesheet" href="index.css"/>
    <link rel="icon" type="image/x-icon" href="favicon.ico"/>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        document.body.addEventListener("click", function(event) {
          var target = event.target
          if (target.className.indexOf("feature-play-gif") > -1) {
            togglePlayback(target.parentElement)
          }
        })
      })

      var reExt = /\.(png|gif)$/
      function togglePlayback(featureEl) {
        var imgEl   = featureEl.querySelector("img")
          , src     = imgEl.src
          , fromExt = getExt(src)
          , toExt   = notExt(fromExt)
        imgEl.src = src.replace(reExt, "." + toExt)
        featureEl.className = featureEl.className
          .replace("feature-" + fromExt,
                   "feature-" + toExt)
      }

      function notExt(ext) { return ext === "png" ? "gif" : "png" }
      function getExt(src) { return reExt.exec(src)[1] }
    </script>
  </head>
  <body>
    <div class="container-center">

      <div class="header">
        <div class="header-links">
          <a class="header-link" href="#setup">install</a>
          <a class="header-link" href="#zooming-and-panning">documentation</a>
          <a class="header-link" href="https://github.com/voxer/zag">source</a>
          <a class="header-link" href="https://github.com/voxer/zag/issues">bugs</a>
        </div>
        <a class="header-link header-title" href="#">zag metrics</a>
      </div>

      <div class="summary">
        <p>
          Zag is a fast, scalable Node.js application for aggregating and visualizing both
          real-time and historical metrics.
        </p>
      </div>

      <div class="features">
        <div class="feature-row">
          {{ feature("images/snaps/histogram.png", "Plot counters and histograms", "#graph-types") }}
          {{ feature("images/snaps/dashboard.png", "Dashboards", "#dashboards") }}
          {{ feature("images/snaps/live.png", "Real-time metrics", "#intervals") }}
        </div>
        <div class="feature-row">
          {{ feature("images/snaps/heat-map.png", "Heat maps", "#histogram") }}
          {{ feature("images/snaps/tags.png", "Tag events", "#tags") }}
          {{ feature("images/snaps/tree-expanded.png", "Navigate thousands of keys", "#metrics-keys") }}
        </div>
      </div>

      <div class="documentation">
        <h3 id="setup">Setup</h3>

        <div class="documentation-setup">{body}</div>

        <h3 id="zooming-and-panning">Zooming and panning</h3>

        {{ feature("images/gifs/zoom-revert-2.gif", "Zoom, zoom, revert, revert") }}
        <div class="col-1">
          <p>
            To zoom a graph in the X or Y direction, just click and drag a range.
            Double-clicking will revert the zoom.
          </p>
          <p>To pan a graph up and down or side-to-side, shift-click and drag.</p>
        </div>
        {{ feature("images/gifs/pan-zoom-pan-1.gif", "Zooming and panning") }}

        <h3 id="graph-types">Graph types</h3>

        {{ feature("images/snaps/counter-2.png", "Counter") }}
        <div class="col-1">
          <h4 id="counter">Counter</h4>
          <p>A counter measures the number of events over an interval.</p>
        </div>
        {{ feature("images/snaps/stack.png", "Stacked counters") }}

        {{ feature("images/snaps/histogram-subkeys.png", "Histogram subkeys") }}
        <div class="col-1">
          <h4 id="histogram">Histogram</h4>
          <p>A histogram measures the distribution of a value. Fields measured:</p>
          <ul>
            <li><code>mean</code> - Mean value</li>
            <li><code>p10, p75, p95, p99</code> - Percentiles</li>
            <li><code>median</code> - 50th percentile</li>
            <li><code>max</code> - Maximum value</li>
            <li><code>std_dev</code> - Standard deviation</li>
            <li><code>count</code> - Total number of values recorded</li>
            <li><code>llquantize</code> - Log/linear quantile data for heat maps</li>
          </ul>
        </div>
        {{ feature("images/gifs/heat-map-zoom-1.gif", "Zooming a heat map") }}

        <h3 id="metrics-keys">Metrics keys</h3>

        <div class="col-2">
          <h4 id="key-structure">Key structure</h4>
          <p>
            Metrics keys may include the characters: <code>[ \w/._()+:-]</code>, as well as <code>&gt;</code>
            and <code>|</code> as separators. Metrics sent with invalid keys are silently ignored.
          </p>
          <p>
            In <code>A|B</code>, <code>A</code> is an aggregate key, which means that every point that
            gets sent to <code>A|B</code>, <code>A|C</code>, etc
            will also automatically be forwarded to <code>A</code>.
          </p>
          <p>In <code>A&gt;B</code>, <code>A</code> has no points associated with it, it is just a scope in the tree widget.</p>
        </div>
        {{ feature("images/snaps/tree-expanded.png", "Navigate thousands of keys") }}

        {{ feature("images/gifs/key-tree-toggle-2.gif", "Expand/collapse key tree") }}
        <div class="col-1">
          <h4 id="key-tree">Key tree</h4>
          <p>Clicking on a triangle expands/collapses the keys.</p>
          <p>Shift-clicking on a triangle graphs all of the key's children.</p>
          <p>
            To create a new key, just start sending it data. Within 2 minutes of receiving the first
            data point, the key will appear in the tree.
          </p>
        </div>
        {{ feature("images/gifs/key-tree-bulk-overlay-1.gif", "Overlay keys") }}

        {{ feature("images/gifs/change-subkey-2.gif", "Overlay by subkey") }}
        <div class="col-1">
          <p>Shift-click on a leaf to overlay it on the current graph.</p>
        </div>
        {{ feature("images/gifs/key-tree-filter-1.gif", "Filter keys") }}

        <h3 id="intervals">Intervals</h3>

        {{ feature("images/gifs/interval-links-1.gif", "Change interval") }}
        <div class="col-1">
          <p>
            By default, the interval is relative, e.g. if the last 6 hours are plotted
            and you reload the graph, it will still be the last 6 hours. To link to a fixed
            range, go to <em>&equiv;/Permalink</em>.
          </p>
          <p>Intervals selected from the "minutes" row of the range selector will be live.</p>
        </div>
        {{ feature("images/gifs/interval-live-1.gif", "Live sub-second metrics") }}

        <h3 id="deltas">Deltas</h3>

        {{ feature("images/gifs/delta-override-2.gif", "Set the downsample interval manually") }}
        <div class="col-2">
          <p>A "delta" is the point's downsample interval.</p>
          <p>
            While data is stored in 1-minute chunks, sometimes it is useful to plot larger
            samples when the interval is large.
          </p>
          <p>Any "delta" smaller than 1-minute will result in a live chart.</p>
        </div>

        <h3 id="dashboards">Dashboards</h3>

        {{ feature("images/snaps/dashboard.png", "A basic dashboard") }}
        <div class="col-1">
          <p>Use dashboards to get a bird's-eye view of related graphs.</p>
        </div>
        {{ feature("images/snaps/dashboard-menu.png", "Select a dashboard") }}

        <h3 id="tags">Tags</h3>

        <div class="col-2">
          <p>
            A tag marks an event globally, across all metrics. For example, you may mark
            server releases so that metrics that change can be correlated after the fact.
          </p>
          <p>Each tag contains the following fields:</p>
          <ul>
            <li><code>id</code>    - Unique identifier for the tag, in the form of <code>{time}_{random}</code>.</li>
            <li><code>ts</code>    - Timestamp marking the tag's location.</li>
            <li><code>label</code> - Some text specific to this tag describing the event that it marks.</li>
            <li><code>color</code> - A hex color, e.g. <code>#f00</code>.</li>
          </ul>
        </div>
        {{ feature("images/snaps/tags.png", "Tags") }}

        {{ feature("images/snaps/tag-new.png", "New tag") }}
        <div class="col-2">
          <p>To start using tags, you need to create some 'tagtypes' using the admin script:</p>
        <code><pre>
$ zag/bin/admin.js tagtype list
$ zag/bin/admin.js tagtype create '#00ff00' 'Server deploy'
$ zag/bin/admin.js tagtype create '#0000ff' 'Client release'</pre></code>
          <p>Tags can be created by either the admin script:</p>
          <code><pre>$ zag/bin/admin.js tag create '#0000ff' 'release 0.12.4' 1393429946985</pre></code>
          <p>
            or in the web UI. To create a tag in the web UI, right-click on the X axis of a graph.
            Left-click a tag on the axis to modify it.
          </p>
        </div>

      </div>
    </div>
  </body>
</html>
